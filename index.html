<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Multiplayer Shooter Vercel</title>
<style>
canvas{background:#07111a; display:block;margin:0 auto;}
body{margin:0;color:#fff;font-family:sans-serif;}
</style>
</head>
<body>
<canvas id="game" width="900" height="600"></canvas>
<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const W=canvas.width,H=canvas.height;

let ws,myId;
let players={}, bullets={};
let mouse={x:W/2,y:H/2,down:false};
let keys={};
let me={x:W/2,y:H/2,angle:0,hp:100};

const SPEED=180;
const BULLET_SPEED=500;

function connect(){
  ws=new WebSocket('wss://YOUR_SERVER_URL'); // <--- replace with your deployed server URL
  ws.onopen=()=>console.log('Connected');
  ws.onmessage=e=>{
    const data=JSON.parse(e.data);
    if(data.type==='init') myId=data.id;
    if(data.type==='state'){ players=data.players; bullets=data.bullets; }
  };
}

function sendUpdate(){
  if(ws && ws.readyState===1)
    ws.send(JSON.stringify({type:'update', x:me.x, y:me.y, angle:me.angle}));
}

function tryShoot(){
  if(!ws || ws.readyState!==1) return;
  const angle=me.angle;
  ws.send(JSON.stringify({
    type:'shoot',
    x: me.x+Math.cos(angle)*16,
    y: me.y+Math.sin(angle)*16,
    vx: Math.cos(angle)*BULLET_SPEED/60,
    vy: Math.sin(angle)*BULLET_SPEED/60
  }));
}

window.addEventListener('mousemove',e=>{
  const rect=canvas.getBoundingClientRect();
  mouse.x=(e.clientX-rect.left)*(canvas.width/rect.width);
  mouse.y=(e.clientY-rect.top)*(canvas.height/rect.height);
});
window.addEventListener('mousedown',e=>mouse.down=true);
window.addEventListener('mouseup',e=>mouse.down=false);
window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

let lastShot=0;

function loop(ts){
  const dt=1/60;
  let dx=0,dy=0;
  if(keys['w']||keys['arrowup']) dy-=1;
  if(keys['s']||keys['arrowdown']) dy+=1;
  if(keys['a']||keys['arrowleft']) dx-=1;
  if(keys['d']||keys['arrowright']) dx+=1;
  const len=Math.hypot(dx,dy);
  if(len>0){dx/=len;dy/=len;}
  me.x+=dx*SPEED*dt; me.y+=dy*SPEED*dt;
  me.angle=Math.atan2(mouse.y-me.y, mouse.x-me.x);
  if(mouse.down && ts-lastShot>150){ tryShoot(); lastShot=ts; }
  sendUpdate(); render(); requestAnimationFrame(loop);
}

function render(){
  ctx.fillStyle='#07111a'; ctx.fillRect(0,0,W,H);
  for(const pid in players){
    const p=players[pid];
    drawPlayer(p.x,p.y,p.angle,p.hp,pid===myId);
  }
  for(const bid in bullets){
    const b=bullets[bid];
    ctx.beginPath(); ctx.arc(b.x,b.y,4,0,Math.PI*2); ctx.fillStyle='#ffd89b'; ctx.fill();
  }
}

function drawPlayer(x,y,angle,hp,isMe){
  ctx.save();ctx.translate(x,y);ctx.rotate(angle);
  ctx.fillStyle=isMe?'#7efc7e':'#6fb3ff';
  ctx.fillRect(-12,-10,24,20);
  ctx.fillStyle='#333';ctx.fillRect(12,-4,10,8);
  ctx.restore();
  ctx.fillStyle='#fff';ctx.font='12px monospace';
  ctx.fillText(hp, x-10, y-18);
}

connect(); requestAnimationFrame(loop);
</script>
</body>
</html>
